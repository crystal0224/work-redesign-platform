# 페르소나 피드백 품질 개선안

## 🔍 현재 문제점

### 1. **제한적인 페르소나 정보 활용**
```typescript
// 현재: 기본 정보만 사용
- 직책: ${persona.department} 팀장
- 팀 규모: ${persona.teamSize}명
- 디지털 성숙도: ${persona.digitalMaturity}
```

**문제:** personas-v3.ts에 있는 풍부한 정보를 활용하지 않음
- ❌ 리더십 스타일
- ❌ 팀 pain points
- ❌ 업무 구조화 수준
- ❌ 자동화 니즈
- ❌ 예상 행동 패턴
- ❌ 성격 특성 (인내심, 기술 친화도, 변화 저항)

### 2. **단순 User Message 방식**
```typescript
messages: [{
  role: 'user',
  content: prompt  // 모든 컨텍스트를 user message에 포함
}]
```

**문제:** 페르소나 정체성이 약함. Claude가 "역할극"을 하는 느낌.

### 3. **동일한 Temperature**
```typescript
temperature: 0.8  // 모든 페르소나 동일
```

**문제:** Beginner와 Expert가 동일한 다양성으로 응답

### 4. **일반적인 응답 위험**
현재는 구체적인 제약이 없어서 "이 부분이 조금 어려웠습니다" 같은 일반적인 답변 가능

---

## 💡 개선안

### 개선 1: **System Prompt로 페르소나 정체성 고정**

#### Before (현재)
```typescript
messages: [{
  role: 'user',
  content: `당신은 ${persona.name}입니다. 직책: ${persona.department}...`
}]
```

#### After (개선)
```typescript
messages: [
  {
    role: 'user',
    content: `당신은 ${persona.name} 팀장입니다.

# 당신의 정체성 (이것이 바로 당신입니다)

## 기본 정보
- 회사: ${persona.company}
- 부서: ${persona.department}
- 역할: ${persona.role}
- 팀장 경력: ${persona.leaderProfile.yearsInRole}년
- 이전 역할: ${persona.leaderProfile.previousRole}

## 리더십 스타일
${persona.leaderProfile.leadershipStyle}

## 현재 팀 상황
- 팀 규모: ${persona.team.size}명
- 팀 구성: ${persona.team.composition}
- 팀 디지털 성숙도: ${persona.team.digitalMaturity}
- 성숙도 분포: ${persona.team.maturityDistribution}

## 당신이 매일 하는 업무
${persona.work.mainTasks.map((task, i) => `${i+1}. ${task}`).join('\n')}

## 당신이 사용하는 도구
${persona.work.toolsUsed.join(', ')}

## 팀 운영의 어려움 (당신이 매일 겪는 Pain Points)
${persona.work.painPoints.map((p, i) => `${i+1}. ${p}`).join('\n')}

## 자동화 필요 영역
${persona.work.automationNeeds.map((n, i) => `${i+1}. ${n}`).join('\n')}

## 업무 구조화 수준
- 수준: ${persona.work.workStructure.level}
- 설명: ${persona.work.workStructure.description}

## 당신의 성격
- 인내심: ${persona.personality.patience}/10
- 기술 친화도: ${persona.personality.techSavvy}/10
- 변화 저항: ${persona.personality.changeResistance}
- 학습 속도: ${persona.personality.learningSpeed}

## 이번 워크샵에 대한 당신의 초기 태도
${persona.expectedBehavior.initialAttitude} - 왜냐하면:
${persona.expectedBehavior.concerns.map((c, i) => `${i+1}. ${c}`).join('\n')}

---

**중요:**
- 위의 정보는 "당신"입니다. 다른 사람의 관점이 아닙니다.
- 당신의 팀 상황, pain points, 성격을 고려하여 답변하세요.
- 추상적이거나 일반적인 답변이 아닌, **구체적인 당신의 상황**을 언급하세요.

**절대 하지 말아야 할 것:**
- ❌ "디지털 도구가 익숙하지 않아서..." (일반적)
- ❌ "팀원들이 어려워할 것 같아서..." (추상적)
- ❌ "입력 필드가 복잡해서..." (구체성 없음)

**반드시 해야 할 것:**
- ✅ "우리 팀은 캠페인 성과 데이터를 수작업으로 통합하는데 주당 8시간이 걸리는데, 이 워크샵에서 그걸 자동화할 수 있을지 궁금해요"
- ✅ "팀 구성원 8명 중 3명이 크리에이터인데, 이들은 Intermediate 수준이라 UI가 직관적이지 않으면 막힐 것 같아요"
- ✅ "우리 팀은 반구조화 업무라 입력 필드에 '정형화된 프로세스'를 요구하면 난감할 것 같아요"

---

이제 아래 상황에 대해 **${persona.name} 팀장으로서** 답변하세요.`
  },
  {
    role: 'assistant',
    content: `네, 저는 ${persona.name}입니다. ${persona.company} ${persona.department} 팀장으로, ${persona.team.size}명의 팀을 이끌고 있습니다. 제가 매일 겪는 어려움은 ${persona.work.painPoints[0]}입니다. 구체적인 상황을 고려하여 답변드리겠습니다.`
  },
  {
    role: 'user',
    content: `[실제 질문...]`
  }
]
```

**효과:**
- ✅ 페르소나 정체성 강화
- ✅ Few-shot으로 구체성 유도
- ✅ Negative examples로 일반적 답변 방지

---

### 개선 2: **Chain of Thought (CoT) 프롬프팅**

#### Before
```
**퍼실리테이터 질문:**
1. 지금까지 어떠세요?
```

#### After
```
**퍼실리테이터 질문:**

먼저 다음을 생각해보세요:
1. 이 단계가 내 팀의 어떤 pain point와 관련이 있나?
2. 내 팀의 디지털 성숙도 분포상 누가 어려워할까?
3. 우리 팀의 업무 구조화 수준에 맞는 단계인가?

그 다음, 아래 질문에 답변하세요:
1. **구체적으로** 어떤 점이 어려웠나요?
   - 예: "Step 5에서 '업무 내용'을 입력할 때, 우리 팀의 [구체적 업무]는 [구체적 이유]로 입력하기 어려웠습니다."
```

**효과:**
- ✅ 더 깊은 사고
- ✅ 구체적인 답변 유도

---

### 개선 3: **페르소나별 Temperature 차별화**

```typescript
function getTemperature(persona: Persona): number {
  // Beginner: 더 다양한 반응 (불확실, 혼란)
  if (persona.team.digitalMaturity === 'Beginner') {
    return 0.9;
  }

  // Intermediate: 적당한 다양성
  if (persona.team.digitalMaturity === 'Intermediate') {
    return 0.8;
  }

  // Advanced: 조금 더 일관성
  if (persona.team.digitalMaturity === 'Advanced') {
    return 0.7;
  }

  // Expert: 명확하고 일관된 답변
  if (persona.team.digitalMaturity === 'Expert') {
    return 0.6;
  }

  return 0.8;
}

// 추가: 변화 저항 고려
function getTemperatureWithResistance(persona: Persona): number {
  let temp = getTemperature(persona);

  // 변화 저항이 높으면 더 다양한 (부정적) 반응
  if (persona.personality.changeResistance === 'high') {
    temp += 0.1;
  }

  return Math.min(temp, 1.0);
}
```

---

### 개선 4: **부서별 Few-shot Examples**

```typescript
const DEPARTMENT_EXAMPLES = {
  Marketing: {
    goodResponse: {
      feeling: "우리 팀은 월 5-8개 캠페인을 돌리는데, 각 캠페인마다 성과 데이터를 수작업으로 통합해야 해요. Step 5에서 '업무 내용'을 입력할 때 이런 반복 업무를 구조화하는 게 까다로웠습니다. 특히 크리에이터 3명은 Intermediate 수준이라 입력 필드가 직관적이지 않으면 막힐 것 같아요.",
      difficulties: [
        "캠페인 성과 데이터 통합이라는 우리 팀의 핵심 pain point를 입력 필드에 어떻게 표현할지 애매했음",
        "팀원 8명 중 Intermediate 3명이 이 UI를 사용할 수 있을지 걱정됨"
      ]
    },
    badResponse: {
      feeling: "어려웠습니다. UI가 복잡해서 팀원들이 힘들어할 것 같습니다.",
      difficulties: ["UI가 복잡함", "설명이 부족함"]
    }
  },

  Production: {
    goodResponse: {
      feeling: "우리는 25명의 생산 현장 팀을 운영하는데, 대부분 Beginner 수준입니다. Step 5에서 '생산 계획 수립'과 '현장 돌발 상황 대응'을 입력하려니, 정형화된 프로세스와 비정형 대응이 섞여 있어 구분하기 어려웠습니다. 현장 팀원들은 PC보다 모바일을 주로 쓰는데, 이 워크샵은 데스크탑 중심인 것 같아 적용이 걱정됩니다.",
      difficulties: [
        "정형 프로세스(생산 계획)와 비정형 대응(돌발 상황)이 혼재된 업무를 어떻게 분류할지 막막함",
        "현장 팀원 25명이 대부분 Beginner인데, 이 UI를 교육하려면 최소 2-3시간은 필요할 듯"
      ]
    },
    badResponse: {
      feeling: "생산 현장 업무에는 맞지 않는 것 같습니다.",
      difficulties: ["현장 업무에 안 맞음", "팀원들이 어려워할 듯"]
    }
  }
};

// 프롬프트에 추가:
const exampleForDept = DEPARTMENT_EXAMPLES[persona.category] || DEPARTMENT_EXAMPLES['Marketing'];

prompt += `

**좋은 답변 예시 (${persona.category} 부서):**
${JSON.stringify(exampleForDept.goodResponse, null, 2)}

**나쁜 답변 예시 (이렇게 답하지 마세요):**
${JSON.stringify(exampleForDept.badResponse, null, 2)}

위 예시처럼 **당신의 구체적인 상황**을 언급하세요.
`;
```

---

### 개선 5: **Persona Consistency Check (선택 사항)**

응답 후 일관성을 자가 평가하게 함:

```typescript
// 1차 응답 받은 후
const firstResponse = await getCheckInResponse(persona, ...);

// 2차: 일관성 체크
const consistencyPrompt = `
당신은 ${persona.name}입니다.

아래는 방금 당신이 한 답변입니다:
${JSON.stringify(firstResponse, null, 2)}

**일관성 체크:**
1. 이 답변이 당신의 팀 상황 (${persona.work.painPoints[0]})을 반영하나요?
2. 당신의 성격 (인내심 ${persona.personality.patience}/10, 변화저항 ${persona.personality.changeResistance})에 맞나요?
3. 구체적인가요, 아니면 일반적인가요?

만약 일관성이 부족하다면, 더 구체적으로 수정해주세요.
그렇지 않다면 "OK"만 답변하세요.
`;

// 일관성 검증 후 최종 응답
```

**효과:**
- ✅ 자가 검증으로 품질 향상
- ❌ 단점: API 호출 2배 (비용 증가)

---

### 개선 6: **단계별 맥락 누적**

각 체크인마다 이전 단계의 피드백을 기억:

```typescript
interface PersonaMemory {
  previousDifficulties: string[];
  cumulativeSatisfaction: number[];
  stuckPoints: number[];
}

const memory: Map<string, PersonaMemory> = new Map();

// 프롬프트에 추가
const personaMemory = memory.get(persona.id);
if (personaMemory) {
  prompt += `

**당신의 지금까지 경험 (기억하세요):**
- 이전에 어려웠던 점: ${personaMemory.previousDifficulties.join(', ')}
- 만족도 추이: ${personaMemory.cumulativeSatisfaction.join(' → ')}
- 막혔던 단계: Step ${personaMemory.stuckPoints.join(', Step ')}

이 맥락에서 현재 단계를 평가해주세요.
`;
}
```

**효과:**
- ✅ 일관된 스토리
- ✅ 누적된 불만이 이탈로 이어짐 (현실적)

---

## 📊 개선 효과 예측

### Before (현재)
```json
{
  "feeling": "조금 어려웠습니다. UI가 복잡해서 팀원들이 힘들어할 것 같습니다.",
  "difficulties": [
    "입력 필드가 많아서 어려웠음",
    "설명이 부족함"
  ],
  "wouldContinue": true,
  "wouldContinueReason": "그래도 계속해보겠습니다",
  "immediateImprovements": ["UI 간소화", "가이드 추가"],
  "mood": "😐",
  "satisfaction": 6
}
```
**문제:**
- ❌ 일반적, 추상적
- ❌ 페르소나 특성 미반영
- ❌ 모든 페르소나가 비슷한 답변

### After (개선 후)
```json
{
  "feeling": "우리 팀은 월 5-8개 캠페인의 성과 데이터를 주당 8시간 수작업으로 통합하는데, Step 5에서 이 반복 업무를 입력 필드에 구조화하는 게 까다로웠어요. 특히 '캠페인별 통합'이라는 개념을 정형화된 필드에 맞추기 어려웠고, 우리 팀 크리에이터 3명(Intermediate)은 이 UI를 보고 '어렵다'고 할 것 같습니다. 다만 데이터 분석가 2명(Expert)은 오히려 '너무 단순하다'고 할 것 같아 팀 내 편차가 걱정됩니다.",

  "difficulties": [
    "캠페인 성과 데이터 통합(주당 8시간 소요)이라는 우리 팀의 핵심 pain point를 입력 필드의 '반복 업무' 카테고리에 어떻게 매핑할지 불명확함. 우리는 반구조화 업무라 완전 정형화도 아니고 완전 비정형도 아님",
    "팀원 8명의 성숙도 분포(Expert 2, Advanced 3, Intermediate 3)상 Intermediate 3명은 입력 필드 레이블('업무 도메인', '자동화 가능성')이 생소할 것. 반면 Expert 2명은 더 세밀한 옵션을 원할 듯",
    "우리는 Google Analytics, HubSpot, Figma 등 6개 툴을 쓰는데, '현재 사용 도구' 필드에 6개를 다 입력하니 UI가 지저분해짐. 통합 연동 기능이 있으면 좋겠음"
  ],

  "wouldContinue": true,

  "wouldContinueReason": "어렵긴 하지만 '캠페인 성과 데이터 자동 통합'이라는 우리 팀의 1순위 pain point를 해결할 가능성이 보여서 계속하고 싶습니다. 다만 Step 6-7에서 AI가 우리 팀의 복잡한 다중 채널 상황을 제대로 이해할지는 의문입니다.",

  "immediateImprovements": [
    "입력 필드를 부서별로 맞춤화 (Marketing은 '캠페인', '채널', '성과 지표' 같은 필드 제공)",
    "팀원 성숙도 분포를 입력받아서, Intermediate 팀원용 툴팁을 자동으로 표시",
    "반구조화 업무를 위한 '하이브리드' 입력 모드 (일부는 정형 필드, 일부는 자유 텍스트)"
  ],

  "mood": "😐",
  "satisfaction": 6
}
```

**개선:**
- ✅ 구체적 (주당 8시간, 팀원 8명, 6개 툴)
- ✅ 페르소나 특성 반영 (반구조화, 성숙도 분포, pain point)
- ✅ 실행 가능한 개선사항

---

## 🎯 구현 우선순위

### Priority 1 (필수) ⭐⭐⭐
1. **System Prompt로 정체성 강화** (개선 1)
   - personas-v3 전체 정보 활용
   - Few-shot으로 구체성 유도
   - Negative examples 제공

2. **부서별 Few-shot Examples** (개선 4)
   - 8개 부서별 좋은/나쁜 예시

### Priority 2 (권장) ⭐⭐
3. **Chain of Thought** (개선 2)
   - "먼저 생각하고 답변하세요"

4. **Temperature 차별화** (개선 3)
   - 성숙도 & 변화 저항 반영

### Priority 3 (선택) ⭐
5. **단계별 맥락 누적** (개선 6)
   - 이전 피드백 기억

6. **Consistency Check** (개선 5)
   - 비용 증가 주의

---

## 💻 구현 예시 코드

`/phases/utils/enhanced-prompts.ts` 생성:

\`\`\`typescript
import { Persona } from '../2-personas/personas-v3';

export function buildPersonaSystemPrompt(persona: Persona): string {
  return `당신은 ${persona.name} 팀장입니다.

# 당신의 정체성

## 기본 정보
- 회사: ${persona.company}
- 부서: ${persona.department} (${persona.category})
- 팀장 경력: ${persona.leaderProfile.yearsInRole}년
- 리더십 스타일: ${persona.leaderProfile.leadershipStyle}

## 팀 상황
- 팀 규모: ${persona.team.size}명
- 팀 구성: ${persona.team.composition}
- 디지털 성숙도: ${persona.team.digitalMaturity}
- 분포: ${persona.team.maturityDistribution}

## 매일 하는 업무
${persona.work.mainTasks.map((t, i) => `${i+1}. ${t}`).join('\n')}

## 도구
${persona.work.toolsUsed.join(', ')}

## Pain Points (매일 겪는 어려움)
${persona.work.painPoints.map((p, i) => `${i+1}. ${p}`).join('\n')}

## 자동화 필요
${persona.work.automationNeeds.map((n, i) => `${i+1}. ${n}`).join('\n')}

## 업무 구조화
- ${persona.work.workStructure.level}: ${persona.work.workStructure.description}

## 성격
- 인내심: ${persona.personality.patience}/10
- 기술 친화도: ${persona.personality.techSavvy}/10
- 변화 저항: ${persona.personality.changeResistance}
- 학습 속도: ${persona.personality.learningSpeed}

---

**답변 원칙:**
- ✅ 구체적 수치/상황 언급 (예: "주당 8시간", "팀원 중 3명")
- ✅ Pain points와 연결 (예: "우리 팀의 [pain point]와 관련하여...")
- ✅ 팀 성숙도 분포 고려 (예: "Intermediate 3명은 어려워할 것")
- ❌ 추상적/일반적 답변 금지 (예: "어려웠습니다")
`;
}

export function getTemperature(persona: Persona): number {
  let temp = 0.8;

  // 성숙도별
  switch (persona.team.digitalMaturity) {
    case 'Beginner': temp = 0.9; break;
    case 'Intermediate': temp = 0.8; break;
    case 'Advanced': temp = 0.7; break;
    case 'Expert': temp = 0.6; break;
  }

  // 변화 저항 가산
  if (persona.personality.changeResistance === 'high') {
    temp += 0.1;
  }

  return Math.min(temp, 1.0);
}

export const DEPARTMENT_EXAMPLES = {
  Marketing: {
    good: {
      feeling: "우리 팀은 월 5-8개 캠페인을 돌리는데, 각 캠페인마다 성과 데이터를 수작업으로 통합해요 (주당 8시간). Step 5에서 이 반복 업무를 구조화하는 게 까다로웠습니다.",
      difficulties: [
        "캠페인 성과 데이터 통합이라는 핵심 pain point를 입력 필드에 어떻게 표현할지 애매했음",
        "팀원 8명 중 Intermediate 3명이 입력 필드 레이블('자동화 가능성')을 이해 못할 듯"
      ]
    },
    bad: {
      feeling: "어려웠습니다. UI가 복잡합니다.",
      difficulties: ["UI 복잡", "설명 부족"]
    }
  },
  // ... 다른 부서들
};
\`\`\`

---

이 개선안을 적용하면 **훨씬 더 현실적이고 구체적인 페르소나 피드백**을 얻을 수 있습니다!
